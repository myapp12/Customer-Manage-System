var home = angular.module("home",[]);



home.controller("homeController",["$scope","homeServices","$window","$http",($scope,homeServices,$window,$http)=>{
    

    
    /**
     * ***********************************************************************************************************************
     * *********************************************************************************************************************** 
     * ***********************************************************************************************************************
     * ***********************************************************************************************************************
     *                                                           status
     * ***********************************************************************************************************************
     * ***********************************************************************************************************************
     * ***********************************************************************************************************************
     * ***********************************************************************************************************************
     */
    $scope.public = "Công khai";
    $scope.textContent = "";
    $scope.feel = " chia sẻ thông tin";

    /**
     * Thông tin người đăng nhập
     */
    $scope.userMain = {
        fullName : "",
        email : ""
    };


    

    $scope.btnSendStatus = ()=>{
        $scope.status = {
            fullName : $scope.userMain.fullName,
            public : $scope.public,
            textContent : $scope.textContent,
            feel : $scope.feel
        };
        homeServices.postStatus($scope.status).then((post) => {
            homeServices.getPosts($scope.userMain.email).then((posts) => {
                $scope.posts = posts.data;
                $scope.public = "Công khai";
                $scope.textContent = "";
                $scope.feel = " chia sẻ thông tin";
            });
            alert("Bài viết đã sẵn sàng ....");
        });
    }



    /**
     * ***********************************************************************************************************************
     * *********************************************************************************************************************** 
     * ***********************************************************************************************************************
     * ***********************************************************************************************************************
     *                                                           Post
     * ***********************************************************************************************************************
     * ***********************************************************************************************************************
     * ***********************************************************************************************************************
     * ***********************************************************************************************************************
     */

    $scope.posts;
    

    /**
     * ***********************************************************************************************************************
     * ***********************************************************************************************************************
     *                                                             Like                 
     * ***********************************************************************************************************************
     * ***********************************************************************************************************************
     */
    $scope.clickLike = (post) => {

        homeServices.clickLike(post,$scope.userMain.email).then(() => {
            homeServices.getPosts($scope.userMain.email).then((posts) => {
                $scope.posts = posts.data;
            });
        });
    }










    /** 
     * ***********************************************************************************************************************
     * ***********************************************************************************************************************
     *                                                             comments                 
     * ***********************************************************************************************************************
     * ***********************************************************************************************************************
     */
    $scope.textComment = ""; // content comment
    
    /**
     * Được gọi khi người dùng click vào btn send comment
     */
    $scope.btnComment = (post) => {
        post.comments.push({
            fullName : $scope.userMain.fullName,
            textContent : $scope.textComment
        });

        homeServices.clickComment(post).then(()=>{
            homeServices.getPosts($scope.userMain.email).then((posts) => {
                $scope.posts = posts.data;
                $scope.textComment = "";
            });
        });
    };
    // END












    /* 
    * Lấy thông tin người đăng nhập : fullName
     */
    homeServices.getUserMain().then( (userMain)=> {
        $scope.userMain.fullName = userMain.data.fullName;
        $scope.userMain.email = userMain.data.email;
        homeServices.getPosts($scope.userMain.email).then((posts) => {
            $scope.posts = posts.data;
        });
    });
    
}]);